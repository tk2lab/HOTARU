[tool.poetry]
name = "hotaru"
version = "5.0.0-rc0"
description = "High performance Optimizer to extract spike Timing And cell location from calcium imaging data via lineaR impUlse"
license = "GPL-3.0-only"
authors = [
    "TAKEKAWA Takashi <takekawa@tk2lab.org>",
]
readme = 'README.md'
repository = "https://github.com/tk2lab/HOTARU"
keywords = [
    "Calcium Imaging",
    "Spike Detection",
    "Cell Extraction",
]
classifiers = [
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
]

[build-system]
requires = ["poetry-core>=1.2.0"]
build-backend = "poetry.core.masonry.api"

[tool.poetry.dependencies]
python = ">=3.8,<3.12"
tensorflow = { version = ">=2.7,<2.13", optional = true }
jax = { extras = ["cuda11-cudnn86"], version = "^0.4.7", optional = true }
flax = { version = "^0.6.8", optional = true }

tifffile = "^2022.8"
pillow = "^9.3.0"
av = "^10.0.0"
scipy = "^1.10.0"
pandas = "^1.5"
#seaborn = "^0.12.1"

hydra-core = "^1.3"
#click = "^8.1"
tqdm = "^4.64"
plotly = "^5.13.0"
dash = "^2.8.1"
setuptools = "^67.6.1"
dash-bootstrap-components = "^1.4.1"

[tool.poetry.extras]
tensorflow = ["tensorflow"]
jax = ["jax", "flax"]

[tool.poetry.scripts]
hotaru = "hotaru.__main__:app"

[tool.poetry.group.dev.dependencies]
jupyterlab = "^3.6"
jupyterlab_nvdashboard = "^0.7"

[[tool.poetry.source]]
name = "jax"
url = "https://storage.googleapis.com/jax-releases/jax_cuda_releases.html"
default = false
secondary = true

[tool.isort]
profile = "black"
multi_line_output = 3
force_grid_wrap = 2

[tool.flake8]
max-line-length = 88
extend-ignore = ["E203"]

[tool.pytest.ini_options]
filterwarnings = [
    #"ignore:the imp module is deprecated:DeprecationWarning",
]

[tool.tox]
legacy_tox_ini = """
[tox]
min_version = 4.0
envlist =
    lint
    py311-tf212
isolated_build = True

[gh-actions]
python =
    3.8: py38-tf28, py38-tf212
    3.10: py310-tf28
    3.11: py311-tf212

[testenv:lint]
skip_install = True
deps =
    isort
    black
    flake8
    pyproject-flake8
commands =
    isort src
    black src
    pflake8 src

[testenv:app]
basepython = python3.10
commands =
    {envpython} -m {posargs}

[testenv:notebook]
basepython = python3.11
deps =
    jax[cuda]
    jupyterlab
    jupyterlab_nvdashboard
install_command =
    pip install --upgrade -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html {opts} {packages}
commands =
    jupyter lab --no-browser

[testenv:py{38,39,310,311}-tf{28,29,210,211,212}]
deps =
    tf28: tensorflow >=2.8,<2.9
    tf29: tensorflow >=2.9,<2.10
    tf210: tensorflow >=2.10,<2.11
    tf211: tensorflow >=2.11,<2.12
    tf212: tensorflow >=2.12,<2.13
changedir = sample
commands =
    python work.py
    #{envpython} -m pytest tests/test_tensorflow.py {posargs}
"""
